{% extends 'tracker/base.html' %}
{% block title %}{{ student.full_name }} — {{ classroom.name }}{% endblock %}

{% block content %}
<div class="space-y-6 max-w-3xl mx-auto">

    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-2xl shadow-lg p-6">
        <h1 class="text-2xl sm:text-3xl font-bold">{{ student.full_name }}</h1>
        <p class="text-blue-100 mt-1 text-sm">Sinf: <strong>{{ classroom.name }}</strong></p>
    </div>

    <!-- NOTES CARD -->
    <div class="mt-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">📝 Eslatmalar</h3>

        <!-- Note form -->
        <form hx-post="{% url 'add_note' enrollment.id %}" hx-target="#notes-list" hx-swap="beforebegin"
            class="flex items-center gap-2 mb-5 bg-white border border-gray-200 rounded-xl shadow-sm p-3">
            {% csrf_token %}
            <input type="text" name="content" placeholder="✏️ Yangi izoh yozing..." required
                class="flex-grow border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition text-gray-700 placeholder-gray-400">
            <button
                class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-5 py-2.5 rounded-lg shadow transition duration-200">
                Qo‘shish
            </button>
        </form>


        <!-- Notes List -->
        <div id="notes-list" class="space-y-3">
            {% for note in notes %}
            {% include 'tracker/note_block.html' %}
            {% endfor %}
        </div>

    </div>

</div>

<!-- ===== Client-side helpers ===== -->
<script>
    // after HTMX swaps content, scroll new note into view and add fade-in
    document.body.addEventListener('htmx:afterSwap', (evt) => {
        // When a new note is inserted into #notes-list or a note gets replaced
        const target = evt.detail.target;
        if (!target) return;

        // If target is a note card or inside #notes-list, animate
        if (target.id && target.id.startsWith('note-')) {
            // add small fade-in
            target.style.opacity = 0;
            target.animate([{ opacity: 0 }, { opacity: 1 }], { duration: 220, easing: 'ease-out' });
            target.style.opacity = 1;
        }
    });
</script>
{% endblock %}